sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast"],function(e,t,o){"use strict";return e.extend("sap.ui.demo.mongodb.controller.Main",{onInit:function(){var e=new t({showEN:false,showDE:true,data:[],vorgaengerData:[],selectedObject:null,vorgaengerPanelHeader:"Vorg채ngerobjekte"});this.getView().setModel(e,"dataModel");console.log("Model initialized and set to view");this.loadData(null,true,"data")},loadData:function(e,t,a,r){var l=this._getDataModel();if(!l){o.show("Data model is not set");return}l.setProperty("/selectedObject",null);l.setProperty("/vorgaengerData",[]);var n=window.location.hostname==="localhost"?"http://localhost:3000/api/":"https://ui5-mongodb-project.vercel.app/api/";var s=n+a;var i=[];if(t){i.push("groupByArchivierungsobjekt=true")}if(e){console.log("Filter for data:",e);i.push("filter="+encodeURIComponent(JSON.stringify(e)))}if(i.length>0){s+="?"+i.join("&")}console.log("Request URL:",s);$.ajax({url:s,method:"GET",success:function(t){console.log("Data loaded successfully:",t);console.log("All DB entries for data filter:",e,t);l.setProperty("/data",t);l.refresh(true);if(e&&t&&t.length>0){var o=t[0];l.setProperty("/selectedObject",o);var a="Vorg채ngerobjekt: "+o.Archivierungsobjekt;l.setProperty("/vorgaengerPanelHeader",a);console.log("Updated header text:",a)}if(r){r(t)}},error:function(e,t,a){console.error("Failed to load data:",t,a);o.show("Failed to load data")}})},onApplyFilter:function(){var e=this.byId("archivierungsobjektInput").getValue();var t=this.byId("textarchivierungsobjekt").getValue();var o={};var a=this;this._getDataModel().setProperty("/selectedObject",null);this._getDataModel().setProperty("/vorgaengerPanelHeader","Vorg채ngerobjekte");if(!e&&!t){this.loadData(null,true,"data");return}if(e){o.Archivierungsobjekt=e;this.loadData(o,true,"data",function(e){if(e&&e.length>0){console.log("All DB entries for data filter:",o,e);var t=e[0];console.log("Setting selected object:",t);a._getDataModel().setProperty("/selectedObject",t);console.log("Calling loadVorgaengerData with:",t.Archivierungsobjekt);a.loadData({archivierungsobjekt:t.Archivierungsobjekt},false,"vorgaenger");var r="Vorg채ngerobjekt: "+t.Archivierungsobjekt;a._getDataModel().setProperty("/vorgaengerPanelHeader",r);console.log("Updated header text:",r)}})}else if(t){var r=this._getDataModel();if(r.getProperty("/showEN")){o.O_EN=t}else{o.O_DE=t}this.loadData(o,true,"data")}},onShowEN:function(){console.log("Show EN button pressed");this.getView().getModel("dataModel").setProperty("/showEN",true);this.getView().getModel("dataModel").setProperty("/showDE",false)},onShowDE:function(){console.log("Show DE button pressed");this.getView().getModel("dataModel").setProperty("/showEN",false);this.getView().getModel("dataModel").setProperty("/showDE",true)},onToggleTable:function(){var e=this.byId("tablePanel");e.setExpanded(!e.getExpanded())},_getDataModel:function(){return this.getView().getModel("dataModel")},onSelectionChange:function(e){var t=e.getSource();var o=t.getSelectedIndices();if(o.length>0){var a=t.getContextByIndex(o[0]);var r=a.getObject();this._getDataModel().setProperty("/selectedObject",r);this.byId("archivierungsobjektInput").setValue(r.Archivierungsobjekt);this.loadData({archivierungsobjekt:r.Archivierungsobjekt},false,"vorgaenger")}}})});
//# sourceMappingURL=Main.controller.js.map